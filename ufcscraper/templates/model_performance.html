{% extends "base.html" %}

{% block title %}Model Performance - UFC Fight Predictions{% endblock %}
{% block nav_performance %}active{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1 class="page-title">
        <i class="fas fa-brain"></i>
        Model Performance
    </h1>
    <p class="page-subtitle">Machine learning metrics and feature analysis</p>
</div>

<!-- Compact Stats Chips -->
<div class="stats-chips">
    <div class="stat-chip">
        <i class="fas fa-robot stat-chip-icon primary"></i>
        <div class="stat-chip-content">
            <span class="stat-chip-value">{{ metrics.model_type if metrics.model_type else 'RF' }}</span>
            <span class="stat-chip-label">Algorithm</span>
        </div>
    </div>

    <div class="stat-chip">
        <i class="fas fa-check-circle stat-chip-icon {{ 'success' if metrics.trained else 'warning' }}"></i>
        <div class="stat-chip-content">
            <span class="stat-chip-value">{{ 'Trained' if metrics.trained else 'Not Trained' }}</span>
            <span class="stat-chip-label">Status</span>
        </div>
    </div>

    <div class="stat-chip">
        <i class="fas fa-database stat-chip-icon info"></i>
        <div class="stat-chip-content">
            <span class="stat-chip-value">{{ "{:,}".format(metrics.training_samples) if metrics.training_samples else 'N/A' }}</span>
            <span class="stat-chip-label">Training Fights</span>
        </div>
    </div>

    <div class="stat-chip">
        <i class="fas fa-crystal-ball stat-chip-icon warning"></i>
        <div class="stat-chip-content">
            <span class="stat-chip-value">{{ metrics.prediction_samples if metrics.prediction_samples else 'N/A' }}</span>
            <span class="stat-chip-label">Predictions</span>
        </div>
    </div>
</div>

<!-- Performance Metrics (if available) -->
{% if metrics.test_accuracy or metrics.test_auc %}
<div class="fighter-profiles-grid mb-4">
    <div class="fighter-profile-card">
        <div class="fighter-profile-header">
            <h3><i class="fas fa-bullseye"></i> Test Accuracy</h3>
        </div>
        <div class="fighter-profile-body text-center">
            <div class="prediction-winner" style="font-size: 3rem;">
                {{ "%.1f"|format(metrics.test_accuracy * 100) }}%
            </div>
        </div>
    </div>

    <div class="fighter-profile-card">
        <div class="fighter-profile-header">
            <h3><i class="fas fa-chart-area"></i> ROC AUC Score</h3>
        </div>
        <div class="fighter-profile-body text-center">
            <div class="prediction-winner" style="font-size: 3rem;">
                {{ "%.3f"|format(metrics.test_auc) }}
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Feature Importance Chart -->
{% if feature_chart %}
<div class="card mb-4">
    <div class="card-header">
        <h5>
            <i class="fas fa-star"></i>
            Feature Importance
        </h5>
    </div>
    <div class="card-body">
        <div id="featureImportanceChart"></div>
    </div>
</div>
{% endif %}

<!-- Model Information -->
<div class="card">
    <div class="card-header">
        <h5>
            <i class="fas fa-info-circle"></i>
            Model Information
        </h5>
    </div>
    <div class="card-body">
        <div class="stats-comparison-grid">
            <div class="comparison-stat-row">
                <div class="comparison-stat-label">Algorithm</div>
                <p class="text-center">{{ metrics.model_type if metrics.model_type else 'Random Forest Classifier' }}</p>
            </div>

            <div class="comparison-stat-row">
                <div class="comparison-stat-label">Training Data</div>
                <p class="text-center">{{ "{:,}".format(metrics.training_samples) if metrics.training_samples else 'N/A' }} completed fights</p>
            </div>

            <div class="comparison-stat-row">
                <div class="comparison-stat-label">Features Used</div>
                <p class="text-center">137+ advanced features including:</p>
                <ul style="list-style-type: none; padding-left: 0; text-align: center; color: var(--text-secondary); font-size: 0.9rem;">
                    <li>• Physical attributes (height, reach, weight, age)</li>
                    <li>• Career statistics (wins, losses, experience)</li>
                    <li>• Fighting style metrics (KO rate, submission rate, finish patterns)</li>
                    <li>• Momentum indicators (win streaks, recent performance)</li>
                    <li>• Opponent quality ratings and strength of schedule</li>
                    <li>• Career stage analysis (peak, rising, declining)</li>
                    <li>• Advanced round statistics (takedown defense, striking defense)</li>
                    <li>• Strike distribution (head, body, leg percentages)</li>
                </ul>
            </div>
        </div>

        <div class="info-box mt-4">
            <i class="fas fa-lightbulb"></i>
            <strong>Note:</strong> The model is trained on historical UFC fight data with leak-free temporal feature engineering
            to ensure predictions are based only on information available before each fight.
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{% if feature_chart %}
<script>
    // Render feature importance chart with dark theme
    var featureData = {{ feature_chart | safe }};

    // Apply dark theme to layout
    featureData.layout.template = 'plotly_dark';
    featureData.layout.paper_bgcolor = '#1e1e1e';
    featureData.layout.plot_bgcolor = '#1a1a1a';
    featureData.layout.font = {
        color: '#e5e5e5',
        family: 'Inter, system-ui, -apple-system, sans-serif'
    };

    // Update marker color to use accent color
    if (featureData.data && featureData.data[0]) {
        featureData.data[0].marker.color = '#6366f1';
    }

    Plotly.newPlot('featureImportanceChart', featureData.data, featureData.layout, {responsive: true});
</script>
{% endif %}
{% endblock %}
